---
title: "Photo Album"
permalink: /photo.html
---

{% include head.html %}

<body id="page-top">
  {% include nav.html %}

  <section id="photos" class="content-section bg-light">
    <div class="container">
      <div class="content-section-heading text-center">
        <h2 class="mb-5">Family Memories</h2>
      </div>

      <div class="photo-grid" aria-live="polite">
        {%- assign items = site.data.photos | default: empty -%}
        {%- for p in items -%}
          {%- assign base = p.base -%}
          {%- assign caption = p.caption | default: '' -%}
          {%- assign thumb800  = p.thumb800  | default: base | replace: '.jpg','_800.jpg'  | replace: '.jpeg','_800.jpeg' | replace: '.png','_800.png' -%}
          {%- assign thumb1200 = p.thumb1200 | default: base | replace: '.jpg','_1200.jpg' | replace: '.jpeg','_1200.jpeg'| replace: '.png','_1200.png' -%}

          <div class="photo-item"
               tabindex="0"
               role="button"
               aria-label="Open photo"
               data-full="{{ base | relative_url }}"
               data-caption="{{ caption | escape }}"
               style="aspect-ratio: 3 / 2;">
            <img class="photo-img"
                 loading="lazy"
                 decoding="async"
                 fetchpriority="low"
                 src="{{ thumb800   | relative_url }}"
                 srcset="{{ thumb800 | relative_url }} 800w, {{ thumb1200 | relative_url }} 1200w"
                 sizes="(min-width: 992px) 31vw, (min-width: 576px) 48vw, 100vw"
                 alt="{{ caption | default: 'Family Photo' | escape }}">
          </div>
        {%- endfor -%}
      </div>
    </div>
  </section>

  <!-- 확대 보기 (모달) -->
  <div class="modal fade" id="photoModal" tabindex="-1" role="dialog" aria-labelledby="photoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="photoModalLabel">Photo Detail</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body d-flex flex-column align-items-center">
          <img class="modal-img" src="" alt="Enlarged Photo">
          <p class="modal-caption mt-3 mb-0 text-center w-100"></p>
        </div>
      </div>
    </div>
  </div>

  {% include scripts.html %}

  <!-- Masonry & imagesLoaded -->
  <script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/imagesloaded@4.1.4/imagesloaded.pkgd.min.js"></script>

  <style>
    .photo-grid { margin: 0 auto; }
    .photo-item {
      width: 31%;
      margin-bottom: 10px;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
      background: #fff;
      position: relative;
      cursor: zoom-in;
    }
    @media (max-width: 992px) { .photo-item { width: 48%; } }
    @media (max-width: 576px) { .photo-item { width: 100%; } }

    .photo-item img.photo-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform-origin: center;
      animation: kenburns 14s ease-in-out infinite alternate;
      animation-play-state: paused;
      display: block;
    }
    @keyframes kenburns {
      0%   { transform: scale(1.02) translate3d(-1%, -1%, 0); }
      100% { transform: scale(1.05) translate3d( 1%,  1%, 0); }
    }

    /* 모달: 화면을 꽉 채우는 쪽으로 최적화 (가운데 정렬 보장) */
    #photoModal .modal-dialog {
      width: auto;
      max-width: 100vw;
      margin: 1rem auto;     /* 좌우 auto로 가로 중앙 정렬 */
    }
    #photoModal .modal-content {
      max-height: calc(100vh - 2rem); /* 상하 여백을 뺀 높이 */
      display: flex;
      flex-direction: column;
      align-items: center;   /* 내용 가로 중앙 */
    }
    #photoModal .modal-body {
      overflow: auto;               /* 캡션이 길어도 스크롤 */
      padding: 0.75rem 1rem 1rem;
      flex: 1 1 auto;
      align-items: center;
      justify-content: center;
      width: 100%;
    }
    #photoModal .modal-img {
      display: block;
      max-width: 100%;
      max-height: calc(100vh - 2rem - 56px - 1.5rem); /* 뷰포트-외여백-헤더-바디패딩 대략치 */
      height: auto;
      border-radius: 8px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
      /* transition 제거 -> 울렁임 방지 */
      touch-action: manipulation;
    }
  </style>

  <script>
    (function($){
      $(function () {
        var $grid = $('.photo-grid');

        // Masonry 초기화
        $grid.imagesLoaded(function () {
          $grid.masonry({
            itemSelector: '.photo-item',
            percentPosition: true,
            gutter: 10
          });
        });

        // 0) 타일 썸네일 로드 실패 시 기본 원본으로 폴백 (물음표 방지)
        document.querySelectorAll('img.photo-img').forEach(function(img){
          img.addEventListener('error', function(){
            var item = img.closest('.photo-item');
            if (!item) return;
            var fallback = item.getAttribute('data-full');
            if (img.src !== fallback) {
              img.removeAttribute('srcset');
              img.removeAttribute('sizes');
              img.src = fallback;
            }
          }, { once: true });
        });

        // 유틸: 디바운스
        function debounce(fn, delay){
          var t; return function(){ clearTimeout(t); var args=arguments, self=this; t=setTimeout(function(){ fn.apply(self,args); }, delay); };
        }

        // 모달 관련
        var $modal = $('#photoModal');
        var $modalImg = $modal.find('.modal-img');
        var $modalCaption = $modal.find('.modal-caption');

        // 1) 사전 프리로드 + 치수 계산 후 모달 표시 (깜빡임/재스케일 방지)
        function openModalWithFit(src, caption){
          var img = new Image();
          img.onload = function(){
            // 뷰포트 한계 내에서 원본을 업스케일 없이 최대화
            var vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
            var vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
            var outerMargin = 32; // modal-dialog margin 1rem 양쪽
            var headerH = $modal.find('.modal-header').outerHeight() || 56;
            var bodyPadV = 24; // .modal-body padding top+bottom

            var maxW = vw - outerMargin * 2;
            var maxH = vh - outerMargin * 2 - headerH - bodyPadV;

            var nw = img.naturalWidth;
            var nh = img.naturalHeight;
            var scale = Math.min(1, maxW / nw, maxH / nh);
            var targetW = Math.floor(nw * scale);

            // 이미지/캡션 주입 전에 사이즈를 먼저 설정
            $modalImg.css({ width: targetW + 'px' });
            $modalImg.attr('src', src);
            $modalCaption.text(caption || '');

            // 모달 콘텐츠 폭을 이미지 폭에 맞춤
            $modal.find('.modal-content').css('max-width', (targetW + 32) + 'px');
            $modal.modal('show');
          };
          img.onerror = function(){
            // 프리로드 실패 시에도 모달을 열되 브라우저에 맡김
            $modalImg.attr('src', src);
            $modalCaption.text(caption || '');
            $modal.modal('show');
          };
          img.src = src;
        }

        var fitModalImageDebounced = debounce(function(){
          // 모달 표시 후에도 창 크기 변경에 적응 (재깜빡임 없이 현재 비율 유지)
          var img = $modalImg[0];
          if (!img || !img.naturalWidth || !img.naturalHeight) return;
          var vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
          var vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
          var outerMargin = 32;
          var headerH = $modal.find('.modal-header').outerHeight() || 56;
          var bodyPadV = 24;
          var maxW = vw - outerMargin * 2;
          var maxH = vh - outerMargin * 2 - headerH - bodyPadV;
          var nw = img.naturalWidth, nh = img.naturalHeight;
          var scale = Math.min(1, maxW / nw, maxH / nh);
          var targetW = Math.floor(nw * scale);
          $modalImg.css({ width: targetW + 'px' });
          $modal.find('.modal-content').css('max-width', (targetW + 32) + 'px');
        }, 100);

        // 클릭/엔터로 모달 열기
        $grid.on('click keydown', '.photo-item', function (e) {
          if (e.type === 'keydown' && e.key !== 'Enter' && e.key !== ' ') return;
          var src = this.dataset.full;
          var caption = this.dataset.caption || '';
          openModalWithFit(src, caption);
        });

        // 리사이즈/오리엔테이션 변경 대응
        $(window).on('resize orientationchange', fitModalImageDebounced);
        if ('visualViewport' in window) {
          window.visualViewport.addEventListener('resize', fitModalImageDebounced, { passive: true });
        }

        // 보이는 타일만 Ken Burns 실행
        if ('IntersectionObserver' in window) {
          var io = new IntersectionObserver(function(entries){
            entries.forEach(function(entry){
              var img = entry.target.querySelector('img.photo-img');
              if (!img) return;
              img.style.animationPlayState = entry.isIntersecting ? 'running' : 'paused';
            });
          }, { rootMargin: '200px' });

          document.querySelectorAll('.photo-item').forEach(function(item){
            io.observe(item);
          });
        }
      });
    })(jQuery);
  </script>
</body>
</html>
